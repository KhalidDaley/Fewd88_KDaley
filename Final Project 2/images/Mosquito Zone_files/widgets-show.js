(function($){$.extend({tablesorter:new function(){var parsers=[],widgets=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",cssSortGroupSelector:"tbody tr:not(.sortGroup)",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,sortAppend:null,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:false,cancelSelection:true,sortList:[],headerList:[],dateFormat:"us",decimal:".",debug:false,headerNode:null};function benchmark(s,d){log(s+","+(new Date().getTime()-d.getTime())+"ms")}this.benchmark=benchmark;function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s)}else{alert(s)}}function buildParserCache(table,$headers){if(table.config.debug){var parsersDebug=""}var rows=$(table).find(table.config.cssSortGroupSelector);if(rows.length>0){var list=[],cells=rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if($.metadata&&($($headers[i]).metadata()&&$($headers[i]).metadata().sorter)){p=getParserById($($headers[i]).metadata().sorter)}else{if((table.config.headers[i]&&table.config.headers[i].sorter)){p=getParserById(table.config.headers[i].sorter)}}if(!p){p=detectParserForColumn(table,cells[i])}if(table.config.debug){parsersDebug+="column:"+i+" parser:"+p.id+"\n"}list.push(p)}}if(table.config.debug){log(parsersDebug)}return list}function detectParserForColumn(table,node){var l=parsers.length;for(var i=1;i<l;i++){if(parsers[i].is($.trim(getElementText(table.config,node)),table,node)){return parsers[i]}}return parsers[0]}function getParserById(name){var l=parsers.length;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==name.toLowerCase()){return parsers[i]}}return false}function buildCache(table){if(table.config.debug){var cacheTime=new Date()}var $rows=$(table).find(table.config.cssSortGroupSelector);var totalRows=$rows.length||0;var totalCells=($rows[0]&&$rows[0].cells.length)||0,parsers=table.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<totalRows;++i){var c=$rows[i],cols=[];cache.row.push($(c));for(var j=0;j<totalCells;++j){cols.push(parsers[j].format(getElementText(table.config,c.cells[j]),table,c.cells[j]))}cols.push(i);cache.normalized.push(cols);cols=null}if(table.config.debug){benchmark("Building cache for "+totalRows+" rows:",cacheTime)}return cache}function getElementText(config,node){if(!node){return""}var t="";if(config.textExtraction=="simple"){if(node.childNodes[0]&&node.childNodes[0].hasChildNodes()){t=node.childNodes[0].innerHTML}else{t=node.innerHTML}}else{if(typeof(config.textExtraction)=="function"){t=config.textExtraction(node)}else{t=$(node).text()}}return t}function appendToTable(table,cache){if(table.config.debug){var appendTime=new Date()}var c=cache,r=c.row,n=c.normalized,totalRows=n.length,checkCell=(n[0].length-1),tableBody=$(table.tBodies[0]),rows=[];for(var i=0;i<totalRows;i++){rows.push(r[n[i][checkCell]]);if(!table.config.appender){var o=r[n[i][checkCell]];var l=o.length;for(var j=0;j<l;j++){tableBody[0].appendChild(o[j])}}}if(table.config.appender){table.config.appender(table,rows)}rows=null;if(table.config.debug){benchmark("Rebuilt table:",appendTime)}applyWidget(table);setTimeout(function(){$(table).trigger("sortEnd")},0)}function buildHeaders(table){if(table.config.debug){var time=new Date()}var meta=($.metadata)?true:false,tableHeadersRows=[];for(var i=0;i<$("tr",table.config.headerNode).length;i++){tableHeadersRows[i]=0}var $tableHeaders=$("th",table.config.headerNode);$tableHeaders.each(function(index){this.column=index;this.count=this.order=formatSortingOrder(table.config.sortInitialOrder);if(checkHeaderMetadata(this)||checkHeaderOptions(table,index)){this.sortDisabled=true}if(!this.sortDisabled){$(this).addClass(table.config.cssHeader).prop("tabIndex",0).attr("role","button")}table.config.headerList[index]=this});if(table.config.debug){benchmark("Built headers:",time);log($tableHeaders)}return $tableHeaders}function checkHeaderMetadata(cell){if(($.metadata)&&($(cell).metadata().sorter===false)){return true}return false}function checkHeaderOptions(table,i){if((table.config.headers[i])&&(table.config.headers[i].sorter===false)){return true}return false}function applyWidget(table){var c=table.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(table)}}function getWidgetById(name){var l=widgets.length;for(var i=0;i<l;i++){if(widgets[i].id.toLowerCase()==name.toLowerCase()){return widgets[i]}}}function formatSortingOrder(v){if(typeof(v)!="Number"){i=(v.toLowerCase()=="desc")?1:0}else{i=(v==(0||1))?v:0}return i}function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true}}return false}function setHeadersCss(table,$headers,list,css){$headers.removeClass(css[0]).removeClass(css[1]);var h=[];$headers.each(function(offset){if(!this.sortDisabled){h[this.column]=$(this)}});var l=list.length;for(var i=0;i<l;i++){h[list[i][0]].addClass(css[list[i][1]])}}function fixColumnWidth(table,$headers){var c=table.config;if(c.widthFixed){var colgroup=$("<colgroup>");$("tr:first td",table.tBodies[0]).each(function(){colgroup.append($("<col>").css("width",$(this).width()))});$(table).prepend(colgroup)}}function updateHeaderSortCount(table,sortList){var c=table.config,l=sortList.length;for(var i=0;i<l;i++){var s=sortList[i],o=c.headerList[s[0]];o.count=s[1];o.count++}}function multisort(table,sortList,cache){if(table.config.debug){var sortTime=new Date()}var dynamicExp="var sortWrapper = function(a,b) {",l=sortList.length;for(var i=0;i<l;i++){var c=sortList[i][0];var order=sortList[i][1];var s=(getCachedSortType(table.config.parsers,c)=="text")?((order==0)?"sortText":"sortTextDesc"):((order==0)?"sortNumeric":"sortNumericDesc");var e="e"+i;dynamicExp+="var "+e+" = "+s+"(a["+c+"],b["+c+"]); ";dynamicExp+="if("+e+") { return "+e+"; } ";dynamicExp+="else { "}var orgOrderCol=cache.normalized[0].length-1;dynamicExp+="return a["+orgOrderCol+"]-b["+orgOrderCol+"];";for(var i=0;i<l;i++){dynamicExp+="}; "}dynamicExp+="return 0; ";dynamicExp+="}; ";eval(dynamicExp);cache.normalized.sort(sortWrapper);if(table.config.debug){benchmark("Sorting on "+sortList.toString()+" and dir "+order+" time:",sortTime)}return cache}function sortText(a,b){if(a===""&&b!==""){return 1}else{if(b===""&&a!==""){return -1}}return((a<b)?-1:((a>b)?1:0))}function sortTextDesc(a,b){if(a===""&&b!==""){return -1}else{if(b===""&&a!==""){return 1}}return((b<a)?-1:((b>a)?1:0))}function sortNumeric(a,b){return a-b}function sortNumericDesc(a,b){return b-a}function getCachedSortType(parsers,i){return parsers[i].type}this.construct=function(settings){return this.each(function(){if(!this.tBodies){return}var $this,$document,$headers,cache,config,shiftDown=0,sortOrder;this.config={};config=$.extend(this.config,$.tablesorter.defaults,settings);if(!config.headerNode){if(!this.tHead){return}config.headerNode=this.tHead}$this=$(this);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var sortCSS=[config.cssDesc,config.cssAsc];fixColumnWidth(this);$headers.on("keypress click",function(e){if(e.type==="keypress"&&e.which!==13){return true}$this.trigger("sortStart");var totalRows=($this[0].tBodies[0]&&$this[0].tBodies[0].rows.length)||0;if(!this.sortDisabled&&totalRows>0){var $cell=$(this);var i=this.column;this.order=this.count++%2;if(!e[config.sortMultiSortKey]){config.sortList=[];if(config.sortForce!=null){var a=config.sortForce;for(var j=0;j<a.length;j++){if(a[j][0]!=i){config.sortList.push(a[j])}}}config.sortList.push([i,this.order])}else{if(isValueInArray(i,config.sortList)){for(var j=0;j<config.sortList.length;j++){var s=config.sortList[j],o=config.headerList[s[0]];if(s[0]==i){o.count=s[1];o.count++;s[1]=o.count%2}}}else{config.sortList.push([i,this.order])}}setTimeout(function(){setHeadersCss($this[0],$headers,config.sortList,sortCSS);appendToTable($this[0],multisort($this[0],config.sortList,cache))},1);return false}}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false};return false}});$this.bind("update",function(){this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this)}).bind("sorton",function(e,list){$(this).trigger("sortStart");config.sortList=list;var sortList=config.sortList;updateHeaderSortCount(this,sortList);setHeadersCss(this,$headers,sortList,sortCSS);appendToTable(this,multisort(this,sortList,cache))}).bind("appendCache",function(){appendToTable(this,cache)}).bind("applyWidgetId",function(e,id){getWidgetById(id).format(this)}).bind("applyWidgets",function(){applyWidget(this)});if($.metadata&&($(this).metadata()&&$(this).metadata().sortlist)){config.sortList=$(this).metadata().sortlist}if(config.sortList.length>0){$this.trigger("sorton",[config.sortList])}applyWidget(this)})};this.addParser=function(parser){var l=parsers.length,a=true;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==parser.id.toLowerCase()){a=false}}if(a){parsers.push(parser)}};this.addWidget=function(widget){widgets.push(widget)};this.formatFloat=function(s){var i=parseFloat(s);return(isNaN(i))?0:i};this.formatInt=function(s){var i=parseInt(s);return(isNaN(i))?0:i};this.isDigit=function(s,config){var DECIMAL="\\"+config.decimal;var exp="/(^[+]?0("+DECIMAL+"0+)?$)|(^([-+]?[1-9][0-9]*)$)|(^([-+]?((0?|[1-9][0-9]*)"+DECIMAL+"(0*[1-9][0-9]*)))$)|(^[-+]?[1-9]+[0-9]*"+DECIMAL+"0+$)/";return RegExp(exp).test($.trim(s))};this.clearTableBody=function(table){if($.browser.msie){function empty(){while(this.firstChild){this.removeChild(this.firstChild)}}empty.apply(table.tBodies[0])}else{table.tBodies[0].innerHTML=""}}}});$.fn.extend({tablesorter:$.tablesorter.construct});var ts=$.tablesorter;ts.addParser({id:"text",is:function(s){return true},format:function(s){return $.trim(s.toLowerCase())},type:"text"});ts.addParser({id:"digit",is:function(s,table){var c=table.config;return $.tablesorter.isDigit(s,c)},format:function(s){return $.tablesorter.formatFloat(s)},type:"numeric"});ts.addParser({id:"currency",is:function(s){return/^[£$€?.]/.test(s)},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/[^0-9.]/g),""))},type:"numeric"});ts.addParser({id:"ipAddress",is:function(s){return/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(s)},format:function(s){var a=s.split("."),r="",l=a.length;for(var i=0;i<l;i++){var item=a[i];if(item.length==2){r+="0"+item}else{r+=item}}return $.tablesorter.formatFloat(r)},type:"numeric"});ts.addParser({id:"url",is:function(s){return/^(https?|ftp|file):\/\/$/.test(s)},format:function(s){return jQuery.trim(s.replace(new RegExp(/(https?|ftp|file):\/\//),""))},type:"text"});ts.addParser({id:"isoDate",is:function(s){return/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(s)},format:function(s){return $.tablesorter.formatFloat((s!="")?new Date(s.replace(new RegExp(/-/g),"/")).getTime():"0")},type:"numeric"});ts.addParser({id:"percent",is:function(s){return/\%$/.test($.trim(s))},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/%/g),""))},type:"numeric"});ts.addParser({id:"usLongDate",is:function(s){return s.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2})( (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM))))?$/))},format:function(s){return $.tablesorter.formatFloat(new Date(s).getTime())},type:"numeric"});ts.addParser({id:"shortDate",is:function(s){return(/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/).test(s)},format:function(s,table){var c=table.config;s=s.replace(/\-/g,"/");if(c.dateFormat=="us"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2")}else{if(c.dateFormat=="uk"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1")}else{if(c.dateFormat=="dd/mm/yy"||c.dateFormat=="dd-mm-yy"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3")}}}return $.tablesorter.formatFloat(new Date(s).getTime())},type:"numeric"});ts.addParser({id:"time",is:function(s){return/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(s)},format:function(s){return $.tablesorter.formatFloat(new Date("2000/01/01 "+s).getTime())},type:"numeric"});ts.addParser({id:"autoDateTime",is:function(s){return !isNaN((new Date(s)).getTime())},format:function(s){return $.tablesorter.formatFloat((new Date(s)).getTime())}});ts.addParser({id:"metadata",is:function(s){return false},format:function(s,table,cell){var c=table.config,p=(!c.parserMetadataName)?"sortValue":c.parserMetadataName;return $(cell).metadata()[p]},type:"numeric"});ts.addWidget({id:"zebra",format:function(table){if(table.config.debug){var time=new Date()}$("tr:visible",table.tBodies[0]).filter(":even").removeClass(table.config.widgetZebra.css[1]).addClass(table.config.widgetZebra.css[0]).end().filter(":odd").removeClass(table.config.widgetZebra.css[0]).addClass(table.config.widgetZebra.css[1]);if(table.config.debug){$.tablesorter.benchmark("Applying Zebra widget",time)}}})})(jQuery);(function(c){c.fn.fullScreen=function(d){var e=c(this[0]).data("fullScreen");if(!e){e=new a(d,this[0])}return e};var a=function(d,e){this.settings=c.extend({},a.defaults,d);this.currentDom=e;this.init()};c.extend(a,{defaults:{fullHeightSelector:".fullHeight"},prototype:{init:function(){var d=this;var e=d.$dom();e.data("fullScreen",d);d.adjustSize();c(window).resize(function(){d.adjustSize()})},$dom:function(){if(!this._$dom){this._$dom=c(this.currentDom)}return this._$dom},adjustSize:function(){var e=this;if(e._disabled){return}var d=c(window).height();e.$dom().parents().andSelf().each(function(){var f=c(this);d-=f.outerHeight()-f.height()});d-=b(e.$dom(),e);e.$dom().children().height(d).each(function(){var f=c(this);if(!f.is(":visible")){return}f.find(e.settings.fullHeightSelector).filter(":visible").each(function(){var h=c(this);var k=h.siblings(e.settings.fullHeightSelector).filter(":visible").add(h);var j=1;if(k.length>1){var g=1.3333;j=k.index(h)==0?g:(k.length-g)/(k.length-1)}h.height(Math.floor((h.parent().innerHeight()-b(h,e))*j/k.length))})})},enable:function(){this._disabled=false;this.adjustSize()},disable:function(){this._disabled=true;this.$dom().children().height("auto").find(this.settings.fullHeightSelector).height("auto")}}});var b=function(d,f){var e=0;d.siblings(":visible").each(function(){var g=c(this);if(g.is(f.settings.fullHeightSelector)){return}if(g.css("position")!="fixed"&&g.css("position")!="absolute"){e+=g.outerHeight(true)}});return e}})(jQuery);(function(c){c.fn.combinationList=function(f){var e=c(this[0]).data("combinationList");if(!e){e=new c.combinationListObject(f,this[0])}return e};c.combinationListObject=function(e,f){this.settings=c.extend({},c.combinationListObject.defaults,e);this.currentList=f;this.init()};c.extend(c.combinationListObject,{defaults:{clipText:false,headerContainerSelector:".headerContainer",hoverOnly:false,initialSort:[],loadedCallback:function(){},scrollableBody:true,searchable:false,searchCompleteCallback:function(){},searchFormSelector:"form",selectable:true,selectionCallback:function(e){},sortable:true,sortGrouping:true,sortHeaders:{},sortTextExtraction:"complex",treeTable:false,treeColumn:0},prototype:{init:function(){var f=this;var h=c(f.currentList);h.data("combinationList",f);if(f.settings.clipText){c(window).resize(function(j){a(f)})}if(f.settings.scrollableBody){h.clone().removeAttr("id").find("tbody").remove().end().appendTo(f.settings.headerContainerSelector).end().end().find("thead").remove()}if(f.settings.selectable){h.blistSelectableList({rowSelectionHandler:function(j){f.settings.selectionCallback(j,f.selectedItems())}})}else{if(f.settings.hoverOnly){h.blistListHoverItems()}}if(f.settings.treeTable){h.treeTable({indent:0,treeColumn:f.settings.treeColumn})}if(f.settings.sortable){h.bind("sortEnd",function(j){b(f,j)});var g={headers:f.settings.sortHeaders,textExtraction:f.settings.sortTextExtraction,widgets:[]};var e={};if(f.settings.sortHeaders){_.each(f.settings.sortHeaders,function(k,j){e[j]=(k.sorter===false)})}h.find("thead th").each(function(j){if(!e[j]){c(this).addClass("sortable")}});if(f.settings.scrollableBody){g.headerNode=c(f.settings.headerContainerSelector).find("table.selectableList thead")}if(f.settings.sortGrouping){g.widgets.push("sortGrouping")}if(f.settings.initialSort.length>0){g.sortInitialOrder=f.settings.initialSort[0][1]==1?"asc":"desc"}h.tablesorter(g);d(f)}if(f.settings.searchable){h.searchable({searchFormSelector:f.settings.searchFormSelector,searchCompleteCallback:function(){f.settings.searchCompleteCallback();h.trigger("applyWidgetId","sortGrouping");a(f);if(f.settings.treeTable){h.find("tr.item.parent.filteredOut").each(function(){c(this).treeTable_disownChildren()});h.find("tr.item.parent:not(.filteredOut)").each(function(){c(this).treeTable_reparentChildren()})}}})}if(h.find("tbody tr").length<1){f.displayNoResults()}f.settings.loadedCallback()},updateList:function(f){var e=this;var g=c(e.currentList);g.find("tbody").html(f);if(e.settings.sortable){c(e.settings.headerContainerSelector).find("table tr th").removeClass("headerSortUp").removeClass("headerSortDown");d(e)}e.settings.loadedCallback();a(e);if(g.find("tbody tr").length>0){if(e.settings.treeTable){g.treeTable({indent:0,treeColumn:e.settings.treeColumn})}g.trigger("update")}else{e.displayNoResults()}},totalItemCount:function(){return c(this.currentList).find("tr.item:not(.filteredOut)").length},selectedItems:function(){return c(this.currentList).find("tr.item.selected")},displayNoResults:function(){var e=this;var g=c(e.settings.headerContainerSelector).find("table tr th").length;var f=c("<tr class='sortGroup'><td colspan='"+g+"'><div>"+c.t("controls.common.no_results")+"</div></td></tr>");c(e.currentList).find("tbody").append(f)}}});var b=function(e,f){var g=c(e.currentList);if(e.settings.treeTable){g.find("tr.child").reverse().each(function(){var h=c(this).attr("class").match(/child-of-(\S+)/);if(h&&h.length>1){var j=c("#"+h[1]);if(j.length==1){j.after(this)}}})}};var a=function(e){if(e.settings.clipText){c(e.currentList).find("tbody .clipText > *").each(function(){blist.widget.clippedText.clipElement(c(this))})}};var d=function(e){c.each(e.settings.initialSort,function(f,g){c(e.settings.headerContainerSelector).find("table tr th:nth("+g[0]+")").addClass(g[1]==1?"headerSortUp":"headerSortDown")})};c.tablesorter.addWidget({id:"sortGrouping",format:function(p){function h(r,t){var q=t.format(r.text(),p,r[0]);var s=q;if(r.hasClass("favorite")){return""}else{if(r.hasClass("type")){s=q+"s"}else{if(t.type=="text"){s=q.slice(0,1).toLowerCase()}else{if(t.id.match(/date/i)){if(q===0){s=""}else{s=blist.util.humaneDate.getFromDate(new Date(q),blist.util.humaneDate.DAY)}}}}}if(s===""){s="none"}return s}if(!p||!p.config||!p.config.sortList||p.config.sortList.length<1||p.config.sortList[0].length<1){return}var o=p.config.sortList[0][0];c("tr.sortGroup",p).remove();var f="";for(var k=0;k<p.tBodies[0].rows.length;k++){var e=c(p.tBodies[0].rows[k]);if(e.hasClass("child")||e.is(":hidden")){continue}var j=c(e[0].cells[o]);var n=h(j,p.config.parsers[o]);if(f!=n){f=n;var l=c("<tr class='sortGroup'/>");var m=p.config.headerNode[0].rows[0].cells.length;var g=c("<td colspan='"+m+"'/>");l.append(g);l.find("td:first-child").append("<div>"+f+"</div>");e.before(l)}}}})})(jQuery);(function(a){a.fn.embedForm=function(c){var d=a.extend({},a.fn.embedForm.defaults,c);return this.each(function(){var g=a(this);var e=a.meta?a.extend({},d,g.data()):d;var f=g.find(e.textareaSelector).text();g.find(e.widthSelector+","+e.heightSelector).keyup(function(){var h=b(g,e,f);g.find(e.sizesSelector).removeClass("selected").filter("[data-width="+h.width+"][data-height="+h.height+"]").addClass("selected")}).keypress(function(h){if((h.which<48||h.which>57)&&!(h.which==8||h.which==0)){return false}});g.find(e.codeSelector).click(function(){a(this).select()});g.find(e.sizesSelector).click(function(h){var j=a(this);j.siblings().removeClass("selected");j.addClass("selected");g.find(e.widthSelector).val(j.attr("data-width"));g.find(e.heightSelector).val(j.attr("data-height"));b(g,e,f)});g.find(e.templateSelector).change(function(h){b(g,e,f)});g.find(e.createTemplateButtonSelector).click(function(h){h.preventDefault();a(".newTemplateModal #newTemplateName").val("");a(".newTemplateModal").jqmShow()});a(".newTemplateModal .submitButton").click(function(h){h.preventDefault();a(this).closest("form").submit()});a(".newTemplateModal form").validate();a.uniform.update(g.find(e.templateSelector).val(a("#embed_default").val()));b(g,e,f)});function b(k,f,j){var h=k.find(f.widthSelector).val();var e=k.find(f.heightSelector).val();var g=k.find(f.templateSelector).val();var l=j.replace("_width_",h).replace("_height_",e).replace("_variation_",g||"");_.defer(function(){k.find(f.textareaSelector).text(l)});if(parseInt(h,10)<425||parseInt(e,10)<425||h==""||e==""){k.find(f.errorMessageSelector).addClass("errorMessage");k.find(f.textareaSelector).attr("disabled",true);f.invalidCallback()}else{k.find(f.errorMessageSelector).removeClass("errorMessage");k.find(f.textareaSelector).removeAttr("disabled");f.validCallback()}return{width:h,height:e}}};a.fn.embedForm.defaults={textareaSelector:"#embed_code",widthSelector:"#embed_width",heightSelector:"#embed_height",templateSelector:"#embed_template",errorMessageSelector:".sizeInformation",sizesSelector:".sizes li",codeSelector:".htmlCode",createTemplateButtonSelector:".createTemplateButton",invalidCallback:function(){},validCallback:function(){}}})(jQuery);
/*! LAB.js (LABjs :: Loading And Blocking JavaScript)
    v2.0.3 (c) Kyle Simpson
    MIT License
*/
(function(r){var v=r.$LAB,k="UseLocalXHR",q="AlwaysPreserveOrder",n="AllowDuplicates",m="CacheBust",l="Debug",e="BasePath",s=/^[^?#]*\//.exec(location.href)[0],C=/^\w+\:\/\/\/?[^\/]+/.exec(s)[0],f=document.head||document.getElementsByTagName("head"),h=(r.opera&&Object.prototype.toString.call(r.opera)=="[object Opera]")||("MozAppearance" in document.documentElement.style),c=function(){},o=c,A=document.createElement("script"),a=typeof A.preload=="boolean",x=a||(A.readyState&&A.readyState=="uninitialized"),y=!x&&A.async===true,z=!x&&!y&&!h;
/*!START_DEBUG*/
;if(r.console&&r.console.log){if(!r.console.error){r.console.error=r.console.log}c=function(D){r.console.log(D)};o=function(E,D){r.console.error(E,D)}}
/*!END_DEBUG*/
;function u(D){return Object.prototype.toString.call(D)=="[object Function]"}function B(D){return Object.prototype.toString.call(D)=="[object Array]"}function g(F,E){var D=/^\w+\:\/\//;if(/^\/\/\/?/.test(F)){F=location.protocol+F}else{if(!D.test(F)&&F.charAt(0)!="/"){F=(E||"")+F}}return D.test(F)?F:((F.charAt(0)=="/"?C:s)+F)}function j(E,F){for(var D in E){if(E.hasOwnProperty(D)){F[D]=E[D]}}return F}function b(E){var F=false;for(var D=0;D<E.scripts.length;D++){if(E.scripts[D].ready&&E.scripts[D].exec_trigger){F=true;E.scripts[D].exec_trigger();E.scripts[D].exec_trigger=null}}return F}function d(F,E,D,G){F.onload=F.onreadystatechange=function(){if((F.readyState&&F.readyState!="complete"&&F.readyState!="loaded")||E[D]){return}F.onload=F.onreadystatechange=null;G()}}function w(D){D.ready=D.finished=true;for(var E=0;E<D.finished_listeners.length;E++){D.finished_listeners[E]()}D.ready_listeners=[];D.finished_listeners=[]}function t(F,G,E,H,D){setTimeout(function(){var I,K=G.real_src,J;if("item" in f){if(!f[0]){setTimeout(arguments.callee,25);return}f=f[0]}I=document.createElement("script");if(G.type){I.type=G.type}if(G.charset){I.charset=G.charset}if(D){if(x){
/*!START_DEBUG*/
;if(F[l]){c("start script preload: "+K)}
/*!END_DEBUG*/
;E.elem=I;if(a){I.preload=true;I.onpreload=H}else{I.onreadystatechange=function(){if(I.readyState=="loaded"){H()}}}I.src=K}else{if(D&&K.indexOf(C)==0&&F[k]){J=new XMLHttpRequest();
/*!START_DEBUG*/
;if(F[l]){c("start script preload (xhr): "+K)}
/*!END_DEBUG*/
;J.onreadystatechange=function(){if(J.readyState==4){J.onreadystatechange=function(){};E.text=J.responseText+"\n//@ sourceURL="+K;H()}};J.open("GET",K);J.send()}else{
/*!START_DEBUG*/
;if(F[l]){c("start script preload (cache): "+K)}
/*!END_DEBUG*/
;I.type="text/cache-script";d(I,E,"ready",function(){f.removeChild(I);H()});I.src=K;f.insertBefore(I,f.firstChild)}}}else{if(y){
/*!START_DEBUG*/
;if(F[l]){c("start script load (ordered async): "+K)}
/*!END_DEBUG*/
;I.async=false;d(I,E,"finished",H);I.src=K;f.insertBefore(I,f.firstChild)}else{
/*!START_DEBUG*/
;if(F[l]){c("start script load: "+K)}
/*!END_DEBUG*/
;d(I,E,"finished",H);I.src=K;f.insertBefore(I,f.firstChild)}}},0)}function p(){var L={},I=x||z,J=[],D={},H;L[k]=true;L[q]=false;L[n]=false;L[m]=false;
/*!START_DEBUG*/
;var F=(window.blist||{}).feature_flags||{};var E=!!(F.debug_assets||F.debug_labjs);L[l]=E;
/*!END_DEBUG*/
;L[e]="";function M(P,R,O){var N;function Q(){if(N!=null){N=null;w(O)}}if(D[R.src].finished){return}if(!P[n]){D[R.src].finished=true}N=O.elem||document.createElement("script");if(R.type){N.type=R.type}if(R.charset){N.charset=R.charset}d(N,O,"finished",Q);if(O.elem){O.elem=null}else{if(O.text){N.onload=N.onreadystatechange=null;N.text=O.text}else{N.src=R.real_src}}f.insertBefore(N,f.firstChild);if(O.text){Q()}}function K(P,T,S,N){var O,R,Q=function(){T.ready_cb(T,function(){M(P,T,O)})},U=function(){T.finished_cb(T,S)};T.src=g(T.src,P[e]);T.real_src=T.src+(P[m]?((/\?.*$/.test(T.src)?"&_":"?_")+~~(Math.random()*1000000000)+"="):"");if(!D[T.src]){D[T.src]={items:[],finished:false}}R=D[T.src].items;if(P[n]||R.length==0){O=R[R.length]={ready:false,finished:false,ready_listeners:[Q],finished_listeners:[U]};t(P,T,O,((N)?function(){O.ready=true;for(var V=0;V<O.ready_listeners.length;V++){O.ready_listeners[V]()}O.ready_listeners=[]}:function(){w(O)}),N)}else{O=R[0];if(O.finished){U()}else{O.finished_listeners.push(U)}}}function G(){var Q,U=j(L,{}),N=[],P=0,R=false,T;function W(Y,X){
/*!START_DEBUG*/
;if(U[l]){c("script preload finished: "+Y.real_src)}
/*!END_DEBUG*/
;Y.ready=true;Y.exec_trigger=X;O()}function V(Z,Y){
/*!START_DEBUG*/
;if(U[l]){c("script execution finished: "+Z.real_src)}
/*!END_DEBUG*/
;Z.ready=Z.finished=true;Z.exec_trigger=null;for(var X=0;X<Y.scripts.length;X++){if(!Y.scripts[X].finished){return}}Y.finished=true;O()}function O(){while(P<N.length){if(u(N[P])){
/*!START_DEBUG*/
;if(U[l]){c("$LAB.wait() executing: "+N[P])}
/*!END_DEBUG*/
;try{N[P++]()}catch(X){
/*!START_DEBUG*/
;if(U[l]){o("$LAB.wait() error caught: ",X)}
/*!END_DEBUG*/
}continue}else{if(!N[P].finished){if(b(N[P])){continue}break}}P++}if(P==N.length){R=false;T=false}}function S(){if(!T||!T.scripts){N.push(T={scripts:[],finished:true})}}Q={script:function(){for(var X=0;X<arguments.length;X++){(function(ab,Z){var aa;if(!B(ab)){Z=[ab]}for(var Y=0;Y<Z.length;Y++){S();ab=Z[Y];if(u(ab)){ab=ab()}if(!ab){continue}if(B(ab)){aa=[].slice.call(ab);aa.unshift(Y,1);[].splice.apply(Z,aa);Y--;continue}if(typeof ab=="string"){ab={src:ab}}ab=j(ab,{ready:false,ready_cb:W,finished:false,finished_cb:V});T.finished=false;T.scripts.push(ab);K(U,ab,T,(I&&R));R=true;if(U[q]){Q.wait()}}})(arguments[X],arguments[X])}return Q},wait:function(){if(arguments.length>0){for(var X=0;X<arguments.length;X++){N.push(arguments[X])}T=N[N.length-1]}else{T=false}O();return Q}};return{script:Q.script,wait:Q.wait,setOptions:function(X){j(X,U);return Q}}}H={setGlobalDefaults:function(N){j(N,L);return H},setOptions:function(){return G().setOptions.apply(null,arguments)},script:function(){return G().script.apply(null,arguments)},wait:function(){return G().wait.apply(null,arguments)},queueScript:function(){J[J.length]={type:"script",args:[].slice.call(arguments)};return H},queueWait:function(){J[J.length]={type:"wait",args:[].slice.call(arguments)};return H},runQueue:function(){var P=H,N=J.length,O=N,Q;for(;--O>=0;){Q=J.shift();P=P[Q.type].apply(null,Q.args)}return P},noConflict:function(){r.$LAB=v;return H},sandbox:function(){return p()}};return H}r.$LAB=p();(function(F,D,E){if(document.readyState==null&&document[F]){document.readyState="loading";document[F](D,E=function(){document.removeEventListener(D,E,false);document.readyState="complete"},false)}})("addEventListener","DOMContentLoaded")})(this);(function(c){var d="blist.util.assetLoading";var l=blist.namespace.fetch(d);var a={libraries:{},translations:{}};var f={libraries:{},stylesheets:{}};var k=[];var e=[];var g;l.loadAssets=function(p,t,u){if(!c.subKeyDefined(p,"stylesheets")&&!c.subKeyDefined(p,"javascripts")&&!c.subKeyDefined(p,"templates")&&!c.subKeyDefined(p,"translations")&&!c.subKeyDefined(p,"modals")&&!c.subKeyDefined(p,"newModals")){if(_.isFunction(t)){t()}return}if(!c.isBlank(p.stylesheets)){var q=_.map(p.stylesheets,function(y){var x=h("/styles/",[y.sheet||y],"stylesheets");if(c.isPlainObject(y)){y.sheet=x[0]}else{y=x[0]}return y});l.loadStylesheets(q,u)}var s=_.isArray(p.javascripts)&&p.javascripts.length>0;var w=_.isArray(p.templates)&&p.templates.length>0;var r=_.isArray(p.modals)&&p.modals.length>0;var o=_.isArray(p.newModals)&&p.newModals.length>0;var n=_.isArray(p.translations)&&p.translations.length>0;var v=_.compact([s,w,n,r,o]).length;var m=_.after(v,function(){if(_.isFunction(t)){t()}});if(v===0){m()}if(w){l.loadPartials(h("/templates/",p.templates,"js-appended-templates"),"js-appended-templates",m)}if(r){l.loadPartials(h("/modals/",p.modals,"modals"),"modals",function(x){if(!c.isBlank(x)){x.socrataJqm()}m()})}if(o){l.loadPartials(h("/modals/",p.newModals,"newModals"),"newModals",m)}if(s){l.loadLibraries(h("/javascripts/",p.javascripts,"libraries"),m)}if(n){l.loadTranslations(p.translations,m)}};l.loadLibraries=function(o,r){var m=_.compact(_.flatten(c.arrayify(o)));if(_.isEmpty(m)){if(_.isFunction(r)){r()}return}g=$LAB;var q={queue:m,callback:r};k.push(q);var p=false;var n=[];_.each(m,function(x){var t=c.isPlainObject(x)?x.url:x;if(a.libraries[t]||f.libraries[t]){if(a.libraries[t]){p=true}return}var s=t;var w=false;if(c.subKeyDefined(x,"jsonp")){var u={};var v="callback_"+_.uniqueId();l[v]=function(){j(t)};u[x.jsonp]=d+"."+v;s+=(t.indexOf("?")>=0?"&":"?")+c.param(u);w=true}if(blist.configuration.development){if(t.indexOf("veapicore")<0){s+=(t.indexOf("?")>=0?"&":"?")+c.param({_:(new Date()).valueOf().toString().slice(0,9)})}g=g.script(s);if(!w){g=g.wait(function(){j(t)})}}else{g=g.script(s);if(s.indexOf("socket.io")>-1){g=g.wait()}if(!w){n.push(t)}}a.libraries[t]=true;p=true});if(n.length>0){g=g.wait(function(){_.each(n,function(s){j(s)})})}if(!p){k=_.without(k,q);if(_.isFunction(r)){r()}}};var j=function(m){f.libraries[m]=a.libraries[m];delete a.libraries[m];var n=[];_.each(k,function(o){if(_.all(o.queue,function(p){return !_.isUndefined(f.libraries[c.isPlainObject(p)?p.url:p])})){if(_.isFunction(o.callback)){o.callback()}n.push(o)}});k=_.without.apply(this,[k].concat(n))};l.loadStylesheets=function(q,r){var p=_.chain(c.makeArray(q)).map(function(s){return !c.subKeyDefined(s,"sheet")?{sheet:s}:s}).map(function(s){return _.isArray(s.sheet)?_.map(s.sheet,function(t){return c.extend({},s,{sheet:t})}):s}).flatten().reject(function(s){return f.stylesheets[s.sheet]}).value();var o=0;var n=p.length;var m="";_.each(p,function(t){var s=t.sheet;if(blist.configuration.development){s+=(s.indexOf("?")>=0?"&":"?")+c.param({_:(new Date()).valueOf().toString().slice(0,9)})}if((c.browser.msie&&c.browser.majorVersion==7&&t.hasSpecialSelectors)||(c.browser.msie&&window.parent!=window&&t.hasImages)||(c.browser.msie&&t.hasFonts)||s.startsWith("http://")||s.startsWith("https://")){n--;if(document.createStyleSheet){document.createStyleSheet(s)}else{c("head").append(c.tag({tagName:"link",type:"text/css",rel:"stylesheet",href:s}))}}else{c.socrataServer.makeRequest({url:s,contentType:"text/css",pageCache:true,dataType:"text",success:function(u){o++;if(!f.stylesheets[t.sheet]){m+=u;f.stylesheets[t.sheet]=true}if(o==n){c("head").append('<style type="text/css">'+m+"</style>\n");if(_.isFunction(r)){r()}}}})}})};l.loadPartials=function(q,p,r){if(c.isBlank(f[p])){f[p]={}}var o=_.reject(c.arrayify(q),function(s){return f[p][s]});if(o.length<1){if(_.isFunction(r)){r()}return}var n="";var m=_.after(o.length,function(){var s=c("#"+p);if(s.length<1){c("body").append(c.tag({tagName:"div",id:p}));s=c("#"+p)}var t=c(n);s.append(t);if(_.isFunction(r)){r(t)}});if(o.length===0){m()}_.each(o,function(s){var t=c.path(s);if(blist.configuration.development){t+=(t.indexOf("?")>=0?"&":"?")+c.param({_:(new Date()).valueOf().toString().slice(0,9)})}c.socrataServer.makeRequest({url:t,pageCache:true,dataType:"text",contentType:"text/html",success:function(u){if(!f[p][s]){n+=u}m();f[p][s]=true}})})};l.loadTranslations=function(m,o){var n=_.filter(c.arrayify(m),function(q){var p=false;if(c.isPlainObject(q)){p=q.force;q=q.key}if(c.subKeyDefined(blist.translations,q)&&!p){return false}if(a.translations[q]===true){return true}a.translations[q]=true;c.socrataServer.makeRequest({url:"/"+blist.locale+"/translations/"+q.replace(/\./g,"/"),contentType:"application/json",dataType:"json",success:function(r){c.extend(true,blist.translations,r);b()}});return true});if(n.length>0){e.push({queue:n,callback:o})}else{if(_.isFunction(o)){o()}}};var b=function(){e=_.filter(e,function(m){if(_.all(m.queue,function(n){return c.subKeyDefined(blist.translations,n.key||n)})){m.callback();return false}return true})};var h=function(n,o,m){return _.map(o,function(q){if(c.subKeyDefined(q,"assets")&&c.subKeyDefined(blist,"assets."+m)){return blist.assets[m][q.assets]}else{var p=c.isPlainObject(q)?q.url:q;if(p&&!p.startsWith("http")&&!p.startsWith("/")){p=n+p}if(c.isPlainObject(q)){q.url=p}else{q=p}return q}})}})(jQuery);var datasetControlsNS=blist.namespace.fetch("blist.datasetControls");blist.datasetControls.hookUpShareMenu=function(f,b,h,g){var c=f.displayType==="story"?"share_story_text":"share_text";var d=escape($.t("controls.common.share."+c,{name:f.name,site:blist.configuration.strings.company}));var j=f.fullUrl;var e=f.shortUrl;var a={menuButtonContents:$.t("controls.common.share.button_prompt"),menuButtonTitle:$.t("controls.common.share.button_tooltip"),contents:[{text:$.t("controls.common.share.networks.facebook"),className:"facebook",rel:"external",href:"http://www.facebook.com/share.php?u="+j},{text:$.t("controls.common.share.networks.twitter"),className:"twitter",rel:"external",href:"http://twitter.com/?status="+d+e},{text:$.t("controls.common.share.networks.email"),className:"email",href:"#email",onlyIf:!g}]};$.extend(a,h);b.menu(a)};blist.datasetControls.unsavedViewPrompt=function(){$("a").on("click",function(h){if(!blist.dataset.temporary||blist.dataset.minorChange){return}if(h.ctrlKey||h.metaKey){return}var b=h.currentTarget;if(b.rel.indexOf("external")>-1){return}if(b.className.indexOf("noRedirPrompt")>-1){return}var d=b.href;if($.isBlank(d)){return}var c=d;var f=window.location.href;if(f.endsWith("#")){f=f.slice(0,-1)}if(window.location.hash.length>0){f=f.slice(0,-window.location.hash.length)}if(d.startsWith(f)){c=d.slice(f.length)}if(c.charAt(0)=="#"){return}if(window.location.href==d){return}h.preventDefault();var g=function(){window.location=d;return true};datasetControlsNS.showSaveViewDialog("leavingSaveDialog",g,g)})};blist.datasetControls.showSaveViewDialog=function(h,f,e,j,c){var a=datasetControlsNS.showSaveViewDialog;var d=$(".saveViewDialog");d.find(".mainError").text("");d.jqmShow();a._customClass=h;if(!$.isBlank(a._customClass)){d.addClass(a._customClass)}var b=function(){setTimeout(function(){if(!$.isBlank(a._customClass)){d.removeClass(a._customClass)}d.find(".viewName").val("")},1000)};d.loadingSpinner({metric:"save",overlay:true});a._saveCallback=f;a._dontSaveCallback=e;a._cancelCallback=j;var g=function(k){var o=d.find(".viewName");var l=o.val();if(k&&$.isBlank(l)){d.find(".mainError").text($.t("screens.ds.save_dialog.validation.view_name_required"));return}d.find(".mainError").text("");var n=function(){d.loadingSpinner().showHide(true);var p=blist.dataset.newBackend;var r=function(t){d.loadingSpinner().showHide(false);var s=false;if(_.isFunction(a._saveCallback)){s=a._saveCallback(t)}if(!s){t.redirectTo()}else{b();d.jqmHide()}};var q=function(s){d.loadingSpinner().showHide(false);d.find(".mainError").text(JSON.parse(s.responseText).message)};if(!$.isBlank(c)){blist.dataset.update(c)}if(k){blist.dataset.name=l;blist.dataset.saveNew(p,r,q)}else{blist.dataset.save(r,q)}};if(!$.isBlank(blist.util.inlineLogin)){var m=$.t("screens.ds.save_dialog.validation.auth_required");blist.util.inlineLogin.verifyUser(function(p){if(p){n()}else{d.find(".mainError").text(m)}},m)}else{n()}};if($.isBlank(a._hookedEvents)){d.find("form").submit(function(k){k.preventDefault();g(true)});d.find("a.save").click(function(k){k.preventDefault();g(d.find(".viewName").is(":visible"))});d.find("a.update").click(function(k){k.preventDefault();g(false)});d.find(".jqmClose").click(function(){b();if(_.isFunction(a._cancelCallback)){a._cancelCallback()}});d.find(".dontSave").click(function(){if(_.isFunction(a._dontSaveCallback)){a._dontSaveCallback()}});a._hookedEvents=true}};blist.datasetControls.datasetRating=function(b,d,a){if(!a&&!$.isBlank(b.data("rating-type"))&&$.isBlank(b.data("rating"))){var c=b.closest("dd").addClass("hide");c.prev("dt").addClass("hide");return}b.stars({onChange:function(e){blist.util.doAuthedAction($.t("controls.common.rate.auth_action_phrase"),function(f){blist.dataset.updateRating({type:b.attr("data-rating-type"),rating:(e*20)},function(g){if(!_.isUndefined(g.type)){d.find(".totalTimesRated").text(parseInt($.trim(d.find(".totalTimesRated").text()))+1)}b.attr("title","");if(_.isFunction(f)){f()}})})}})};blist.datasetControls.datasetContact=function(c){var a=function(){var d=c.find("#contactPurpose");var f=d.val();var e="";if($.isBlank(f)){return}if(f=="other"){e=$.t("screens.ds.dataset_contact.other_subject",{dataset_name:blist.dataset.name,site:blist.configuration.strings.company})}else{e=$.t("screens.ds.dataset_contact.subject",{dataset_name:blist.dataset.name,reason:$.t("screens.ds.dataset_contact.reasons."+f)})}c.find("#contactSubject").val(e);c.find("#contactBody").focus()};var b=function(){c.find(".contactOwnerForm").slideToggle().find("#contactBody").focus().end().end().find(".contactOwnerLinks").slideToggle().end()};c.delegate(".contactButton","click",function(g){g.preventDefault();var h=$(this);c.find(".flash").removeClass("notice").text("").fadeOut();if($.subKeyDefined(blist,"datasetPage.sidebar")&&blist.datasetPage.sidebar.$dom().width()<350){blist.datasetPage.sidebar.$dom().width(350);$(window).resize()}if(c.find(".contactOwnerForm").length===0){h.closest(".formSection").after($.renderTemplate("aboutDataset_contact"));blist.util.loadCaptcha("contactCaptcha");var e=c.find(".contactOwnerForm").addClass("sectionContent");e.parent().addClass("formSection");e.validate({rules:{type:"required",subject:"required",message:"required",from_address:{required:true,email:true}},messages:{type:$.t("screens.ds.dataset_contact.validation.no_purpose"),subject:$.t("screens.ds.dataset_contact.validation.no_subject"),message:$.t("screens.ds.dataset_contact.validation.no_body"),from_address:{required:$.t("screens.ds.dataset_contact.validation.no_email")}},errorPlacement:function(k,l){k.appendTo(l.closest(".lined"))}});var d=c.find("#contactPurpose").change(a);if(!d.parent().hasClass("uniform")){d.uniform()}e.submit(function(k){k.preventDefault();if(e.valid()){$.ajax({url:e.attr("action"),data:e.serialize(),type:"POST",dataType:"json",error:function(){c.find(".flash:not(.recaptcha_flash)").removeClass("notice").addClass("error").text($.t("screens.ds.dataset_contact.error_message")).show()},success:function(l){if(l.success==true){_.defer(function(){c.find(".flash:not(.recaptcha_flash)").removeClass("error").addClass("notice").text($.t("screens.ds.dataset_contact.success_message")).show();b()});c.find(".recaptcha_flash").removeClass("error").fadeOut()}else{if(l.success==false){c.find(".recaptcha_flash").removeClass("notice").addClass("error").text($.t("recaptcha.errors.verification_failed")).fadeIn()}}}})}});c.find(".sendContactButton").click(function(k){k.preventDefault();e.submit()})}var f=c.find(".contactOwnerForm");f[0].reset();f.validate().resetForm();b();if(!_.isUndefined(h.attr("data-select"))){var j=c.find("#contactPurpose");j.val(h.attr("data-select"));a();$.uniform.update(j)}})};blist.datasetControls.getColumnTip=function(a){return'<div class="blist-th-tooltip '+a.renderTypeName+'"><p class="name">'+$.htmlEscape(a.name).replace(/ /,"&nbsp;")+"</p>"+(!$.isBlank(a.metadata.originalName)?'<p class="originalName"><span class="title">'+$.t("screens.ds.column_tip.original_name")+':</span> <span class="value">'+$.htmlEscape(a.metadata.originalName).replace(/ /,"&nbsp;")+"</span>":"")+(a.description!==undefined?'<p class="description">'+$.htmlEscape(a.description)+"</p>":"")+'<p class="columnType"><span class="blist-th-icon"></span>'+$.t("core.data_types."+a.dataTypeName)+(a.format.grouping_aggregate!==undefined?" "+$.t("screens.ds.column_tip.aggregate",{aggregate:$.t("core.aggregates."+a.format.grouping_aggregate),data_type:$.t("core.data_types."+a.dataTypeName)}):"")+"</p>"+(a.fieldName!==undefined?'<br/><p class="api-field">'+$.t("screens.ds.column_tip.field_name")+": "+$.htmlEscape(a.fieldName)+"</p>":"")+"</div>"};blist.datasetControls.raReasonBox=function(a){var d=a.siblings("input");var c=a.children("textarea");a.addClass("hide jsEnabled");a.append(a.siblings(".button").clone());a.append($.tag({tagName:"a",href:"#Close","class":"remove",contents:{tagName:"span","class":"icon"}}));a.closest("form").validate();var b=function(){a.addClass("hide");a.closest("form").css("z-index","");c.blur()};c.keydown(function(f){if(f.which==27){b()}});a.find(".remove").click(function(f){f.preventDefault();b()});d.click(function(f){if(a.hasClass("hide")){f.preventDefault();a.removeClass("hide");a.closest("form").css("z-index",10);c.focus()}})};blist.datasetControls.editPublishedMessage=function(){var g="editPublishedMessage"+_.uniqueId();var f=$.tag({tagName:"div","class":"editPublishedMessage",id:g,contents:{tagName:"div","class":"throbber"}});var e=true;var c=function(m,k){var o=blist.datasetControls.copyPending||k;var j=$("#"+g);if(j.length===0){j=f}if((j.length===0)||(!e&&(j.closest("body").length===0))){return}if(j.find(".doneCopyingMessage").is(":visible")){return}j.empty().append($.renderTemplate("editAlertTemplate",m,{".editPublished@class+":function(){return o?"hide":""},".editMessage":function(){return d(m)},".editMessage@class+":function(){return o?"hide":""},".copyingMessage":function(){return $.t("screens.ds.dataset_status.copy_in_progress",{additional:m.message})},".copyingMessage@class+":function(){return o?"":"hide"}}));var l=j.closest(".bt-wrapper");if(l.length>0){var h=l.data("socrataTip-$element");var n=h.data("socrataTip");n.refreshSize()}if(!blist.dataset._unpublishedView){window.setTimeout(function(){a()},30000)}e=false};var d=function(h){if(blist.dataset.isImmutable()){return $.t("screens.ds.dataset_status.immutable")}else{return $.t("screens.ds.dataset_status.needs_copy",{status:$.t("screens.ds.dataset_status.needs_copy_status."+h.status)})}};var b=false;var a=function(){blist.dataset.getOperationStatuses(function(k){var l={};var j=false;var h=function(m){return blist.util.humaneDate.getFromDate(new Date(m*1000))};switch(k.copying.copyStatus){case"finished":l.status=b?"available":"can_be_made";break;case"queued":l.message=$.t("screens.ds.dataset_status.copy_in_progress_additional.queued",{time:h(k.copying.queuedAt),totalQueued:k.copying.totalQueued});j=true;break;case"processing":l.message=$.t("screens.ds.dataset_status.copy_in_progress_additional.processing",{time:h(k.copying.startedAt)});j=true;break;case"failed":l.status="can_be_made"}b=b||j;c(l,j)})};blist.dataset.getUnpublishedDataset(function(h){if($.isBlank(h)){a()}else{c({status:"available"},false)}});return f};blist.datasetControls.hookUpPublishing=function(a){a.find(".unpublished").socrataTitleTip();a.find(".snapshotted").socrataTitleTip();a.find(".publish").click(function(b){b.preventDefault();if($(b.target).hasClass("disabled")){return}blist.dataset.publish(function(c){c.redirectTo()},function(d){var c=$.t("screens.ds.dataset_status.error_publishing_html");if((JSON.parse((d||{}).responseText)||{}).message=="Only unpublished datasets can be published."){c=$.t("screens.ds.dataset_status.error_publishing_unpublished")}a.find("#datasetName").socrataTip({content:$.tag({tagName:"p","class":"errorMessage",contents:c}),showSpike:false,trigger:"now"})})});if(a.find(".publish").exists()){blist.dataset.getPublishingAvailable(function(d,b){var c=a.find(".publish");if(!d){c.addClass("disabled").attr("title",b)}c.socrataTitleTip()})}if(!blist.dataset.isPublished()){blist.dataset.getPublishedDataset(function(b){if(!$.isBlank(b)){a.find("#publishedLink").attr("href",b.url).find(".publishedName").text(b.name)}else{a.find("#publishedLink").hide()}})}};(function(e){var g={".commentActions .commentInappropriateLink":function(h){return h.context.commentFlagged?e.t("controls.feed.comment_actions.already_marked_inappropriate"):e.t("controls.feed.comment_actions.inappropriate")},".commentActions .commentInappropriateLink@class+":function(h){return h.context.commentFlagged?"disabled":""},".commentActions .upRatings":function(h){return(h.context.upRatings>0)?("+"+h.context.upRatings):""},".commentActions .downRatings":function(h){return(h.context.downRatings>0)?("-"+h.context.downRatings):""},".commentActions .rateUp@class+":function(h){return(!_.isUndefined(h.context.currentUserRating)&&h.context.currentUserRating.thumbUp===true)?" ratedUp":""},".commentActions .rateDown@class+":function(h){return(!_.isUndefined(h.context.currentUserRating)&&h.context.currentUserRating.thumbUp===false)?" ratedDown":""},".commentActions@class+":function(h){return _.compact([(_.get(h.context,"user.id")==blist.currentUserId)?"ownItem":null,((!_.isUndefined(blist.currentUser)&&_.include(blist.currentUser.rights,blist.rights.user.MODERATE_COMMENTS))?"isModerator":null)]).join(" ")}};var c={comment:g,reply:g,view:{".viewDetails@class+":"viewType",".viewName":"viewName!",".viewName@href":"viewPath",".viewDescription":"viewDescription!"}};var f={};e(function(){_.each(["comment","view","reply"],function(h){f[h]=e.compileTemplate("feedItem_"+h,c[h])})});var d=function(h,j){return _.detect(j.views.concat(j.mainView),function(k){return k.id==h})};e.fn.feedList=function(t){var j=e.extend({},e.fn.feedList.defaults,t);var q={".@class+":function(u){return _.compact([(j.highlightCallback(u.item)?u.item.itemType+" specialFeedItem":u.item.itemType),(u.item.itemDeleted?"itemDeleted":null)]).join(" ")},".@data-itemId":"feedItem.itemId",".feedCommon@class+":"feedItem.itemType",".feedActor":"feedItem.user.displayName!",".feedActor@href":function(u){return new User(u.item.user).getProfileUrl()},".feedBody":"feedItem.body!",".feedTimestamp":function(u){return blist.util.humaneDate.getFromDate(u.item.timestamp*1000)},".feedCustom":function(u){var v=f[u.item.itemType];return _.isFunction(v)?v(u.item):""}};var k=e.compileTemplate("feedItem",{li:{"feedItem<-":q}});var s={li:{"feedItem<-":e.extend({},q,{".@data-serialId":"feedItem.serialId",".feedChildren":function(u){return _.isArray(u.item.children)?k(u.item.children):""},".feedChildren@class+":function(u){return(_.isUndefined(u.item.children)||(u.item.childCount===0))?"hide":""},".replyViewAllLink":function(u){return e.t("controls.feed.listing.all_replies_with_count",{count:u.item.childCount})},".replyViewAllLink@class+":function(u){return(_.isUndefined(u.item.children)||(u.item.childCount<=j.replyPageLimit))?"hide":""}})}};var o=function(v,u){return{itemType:u||"comment",itemId:v.id,body:_.compact([v.title,v.body]).join(" "),timestamp:v.createdAt,downRatings:v.downRatings,upRatings:v.upRatings,currentUserRating:v.currentUserRating,commentFlagged:_.include(v.flags||[],"flaggedByCurrentUser"),user:v.user,viewId:(v.view?v.view.id:null),children:_.isUndefined(v.children)?[]:_.map(v.children,function(w){return o(w,"reply")})}};var n=_.map(_.reject(j.comments,function(u){return e.isBlank(u.title)&&e.isBlank(u.body)}),function(u){return o(u)});var r=_.map(j.views,function(u){return{itemType:"view",itemId:u.id,body:e.t("controls.feed.listing.user_create_action",{thing:u.displayName}),timestamp:u.createdAt,viewName:u.name,viewType:"type"+u.styleClass,viewPath:u.url,viewDescription:u.description,user:u.owner}});var p=n.concat(r);p.sort(function(v,u){return u.timestamp-v.timestamp});var m={};var l=[];var h=function(u){if(!_.isUndefined(u.children)){u.childCount=u.children.length;u.allChildren=u.children;u.children=u.allChildren.slice(0,j.replyPageLimit)}u.serialId=_.uniqueId();m[u.serialId]=u;return u};p=_.map(p,h)||[];return this.each(function(){var C=e(this);var D=C;var u=j.$scrollContainer||C.closest(j.scrollContainerSelector);var y=C.find(".feedFilter");var w=C.find(".feedList");var E=C.find(".feedMoreItemsLink");var A=C.find(".moderationNotice");if(!_.isArray(j.filterCategories)||(j.filterCategories.length===0)){C.find(".feedFilterLine").hide()}else{y.empty().append(e.tag(_.map(j.filterCategories,function(F){return{tagName:"option",value:F,contents:e.t("controls.feed.types."+F)}}),true)).val(j.defaultFilter||_.first(j.filterCategories));if(!e.isBlank(e.uniform)&&!e.isBlank(e.uniform.update)){e.uniform.update(y)}}var z=function(F){if(F=="all items"){return p}else{var G={view:"views",comment:"comments",replies:"comments"};return _.select(p,function(H){return G[H.itemType]==F})}};var x=function(I){var H=j.pageSize;if(I){H=j.firstPageSize||j.pageSize}var F=w.children().length;w.append(e.renderTemplate("feedItem",l.slice(F,F+H),s));var G=l.length-F-H;E.show();if(G<=0){E.hide()}else{if(G==1){E.text(e.t("controls.feed.listing.last_item"))}else{E.text(e.t("controls.feed.listing.next_item_page",{count:Math.min(G,j.pageSize)}))}}if(!I){u.animate({scrollTop:Math.min(C.outerHeight(true)-u.height(),u.scrollTop()+u.height())},"slow")}else{C.find(".noResults").toggleClass("hide",w.children().length>0)}};var B=function(K,F){var J=b(D);if(e.isBlank(J)){return}var I=h(o(K));if(!e.subKeyDefined(F,"id")){J.feedData.unshift(I);D.children(".feedList").prepend(e.renderTemplate("feedItem",[I],s))}else{var H=D.find('.feedItem[data-itemid="'+F.id+'"]');if(H.length<1){return}I.itemType="reply";var G=J.feedMap[a(H)];G.allChildren.unshift(I);G.children.unshift(I);G.children.splice(j.replyPageLimit,1);H.find(".feedChildren").removeClass("hide").prepend(k([I]))}D.find(".noResults").addClass("hide")};E.click(function(F){F.preventDefault();x()});y.change(function(F){l=z(e(this).val());w.empty();x(true)});if(!j.hideFeed){l=z(j.defaultFilter);x(true)}C.data("feedList-data",{feedData:l,feedMap:m,opts:j});C.delegate(".replyViewAllLink","click",function(F){F.preventDefault();var H=e(this);var G=b(H);H.siblings(".feedChildren").empty().append(k(G.feedMap[a(H)].allChildren));H.remove()});if(!j.hideFeed){_.each(j.views,function(F){F.bind("new_comment",B)},C)}else{D.find(".feedList, .feedMoreItemsLink, .noResults").addClass("hide")}if(j.bindCommentEvents===true){C.delegate(".commentActions a","click",function(H){H.preventDefault();var K=e(this);var I=b(K);var M=I.feedMap[a(K,".comment")];var F=K.closest(".feedItem.reply");if(F.length>0){var J=parseInt(F.attr("data-itemId"));M=_.detect(M.allChildren,function(N){return N.itemId==J})}if(K.is(".commentInappropriateLink:not(.disabled)")){blist.util.doAuthedAction(e.t("controls.feed.authed_actions.flag_comment"),function(N){j.actionDelegate(M,j).flagComment(M.itemId,function(){M.commentFlagged=true;K.fadeOut(function(){K.addClass("disabled").text(e.t("controls.feed.comment_actions.marked_inappropriate")).fadeIn()});if(_.isFunction(N)){N()}})})}else{if(K.is(".commentDeleteLink")){blist.util.doAuthedAction(e.t("controls.feed.authed_actions.delete_comment"),function(N){j.actionDelegate(M,j).removeComment(M.itemId,function(){M.itemDeleted=true;K.closest(".feedItem").animate({opacity:0.3},2000);if(_.isFunction(N)){N()}})})}else{if(K.is(".commentRateUpLink:not(.ratedUp)")||K.is(".commentRateDownLink:not(.ratedDown)")){var G=K.hasClass("commentRateUpLink");blist.util.doAuthedAction(e.t("controls.feed.authed_actions.rate_comment"),function(N){j.actionDelegate(M,j).rateComment(M.itemId,G,function(){var O=G?"up":"down";if(!_.isUndefined(M.currentUserRating)){M[(G?"down":"up")+"Ratings"]--;K.closest("li").siblings().removeClass("ratedUp ratedDown")}M.currentUserRating={thumbUp:G};M[O+"Ratings"]++;K.closest("li").addClass("rated"+O.capitalize());_.each({up:"+",down:"-"},function(P,Q){var R=P+M[Q+"Ratings"];if(M[Q+"Ratings"]===0){R=""}K.closest("li").siblings("."+Q+"Ratings").text(R)});if(_.isFunction(N)){N()}})})}else{if(K.is(".commentReplyLink")&&(K.closest(".feedItem").children(".newCommentForm").length===0)){var L=e.renderTemplate("feedItem_newComment");L.find(".postNewCommentButton").data("view",j.actionDelegate(M,j));K.closest(".feedItem").children(".feedChildren").before(L);K.closest(".feedItem").find("#newCommentBody").focus()}}}}});C.delegate(".newCommentForm .cancelNewCommentButton","click",function(F){F.preventDefault();var G=e(this);if(e.isBlank(G.siblings("#newCommentBody").val())||confirm(e.t("controls.feed.comment_actions.delete_confirm"))){G.closest(".newCommentForm").remove()}});C.delegate(".newCommentForm .postNewCommentButton","click",function(H){H.preventDefault();var J=e(this);var F=J.data("view");var I=J.siblings("#newCommentBody").val();if(!e.isBlank(I)){J.siblings(".error").slideUp();var G=e.extend({},j.commentCreateData,{body:I});var K=parseInt(J.closest(".feedItem").attr("data-itemId"));if(_.isNumber(K)&&!isNaN(K)){G.parent={id:K}}blist.util.doAuthedAction(e.t("controls.feed.authed_actions.post_comment"),function(L){F.addComment(G,function(M){if(M.status=="pending"){J.closest(".newCommentForm").remove();A.fadeIn(300,function(){A.effect("highlight",5000)});return}var N=h(o(M));if(_.isFunction(j.addCommentCallback)){j.addCommentCallback(F,N)}J.closest(".newCommentForm").remove();if((j.alwaysShowNewCommentForm===true)&&(D.find(".newCommentForm").length===0)){v(D.find(".noResults"),j.mainView)}if(_.isFunction(L)){L()}},function(M){J.siblings(".error").slideDown().text(JSON.parse(M.responseText).message)})})}else{J.siblings(".error").text(e.t("controls.feed.comment_form.empty_body_error")).slideDown()}});C.delegate(".feedNewCommentButton","click",function(F){F.preventDefault();var G=e(this);if(G.siblings(".newCommentForm").length===0){v(G,b(G).opts.mainView);G.siblings(".newCommentForm").find("#newCommentBody").focus()}});var v=function(G,F){var H=e.renderTemplate("feedItem_newComment");H.find(".postNewCommentButton").data("view",F);G.after(H)};if(j.alwaysShowNewCommentForm===true){v(C.find(".noResults"),j.mainView)}}})};var b=function(h){return h.closest(".feed").data("feedList-data")};var a=function(h,j){return parseInt(h.closest(".feedItem"+(j||"")).attr("data-serialId"))};e.fn.feedList.defaults={addCommentCallback:function(h,j){},actionDelegate:function(j,h){return d(j.viewId,h)},alwaysShowNewCommentForm:false,bindCommentEvents:true,commentCreateData:{},comments:[],defaultFilter:"comments",filterCategories:["all items","comments","views"],hideFeed:false,highlightCallback:function(h){return blist.dataset&&((h.user||{}).id==blist.dataset.tableAuthor.id)},firstPageSize:null,mainView:null,pageSize:20,replyPageLimit:2,scrollContainerSelector:".scrollContent",views:[]}})(jQuery);(function(a){a.fn.stars=function(b){var c=a.extend({},a.fn.stars.defaults,b);return this.each(function(){var d=a(this);d.addClass("jsEnabled");if(!a.isBlank(c.value)){d.attr("data-rating",c.value);d.attr("title",a.t("controls.common.stars.tooltip",{number:c.value}));d.find(":radio").eq(parseInt(c.value)).attr("checked","checked")}d.on("change",function(f){_.defer(function(){if(_.isFunction(c.onChange)){c.onChange(d.find(":radio:checked").val())}})})})};a.fn.stars.defaults={onChange:function(b){},value:null}})(jQuery);(function(a){a.fn.scrollTabs=function(c){var g=a.extend({},a.fn.scrollTabs.defaults,c);return this.each(function(){var k=a(this);var j=a.meta?a.extend({},g,k.data()):g;k.data("config-scrollTabs",j);a(window).resize(function(){e(k)});e(k)});function e(k){var j=k.data("config-scrollTabs");if(d(k)){a(j.scrollArrowsSelector).show();a(j.scrollArrowPrevSelector).addClass("disabled");a(j.scrollArrowsSelector+".disabled a").live("click",function(l){l.preventDefault()});a(j.scrollArrowsSelector+":not('.disabled') a").live("click",function(l){l.preventDefault();var m=a(this);if(m.closest("li").is(".prev")){h(k)}else{f(k)}b(k)})}else{a(j.scrollArrowsSelector).hide();a(j.scrollArrowPrevSelector).removeClass("disabled");a(j.scrollArrowsSelector+".disabled a").die("click");a(j.scrollArrowsSelector+":not('.disabled') a").die("click")}}function d(l){var j=l.data("config-scrollTabs");var k=0;a(j.scrollableSelector).each(function(){k+=a(this).outerWidth()});return k>a(j.containerSelector).width()}function b(p){var l=p.data("config-scrollTabs");var k=a(l.scrollArrowPrevSelector);var j=a(l.scrollArrowNextSelector);if(a("."+l.scrolledAwayClass).length>0){k.removeClass("disabled")}else{k.addClass("disabled")}var o=a(l.containerSelector).width()-(k.outerWidth()+j.outerWidth());var n=l.scrollableSelector+":not('."+l.scrolledAwayClass+"')";var m=0;a(n).each(function(){m+=a(this).outerWidth()});if(m>o){j.removeClass("disabled")}else{j.addClass("disabled")}}function h(n){var l=n.data("config-scrollTabs");var k=a(a(l.scrollableSelector+"."+l.scrolledAwayClass+":last"));var j=0;a("."+l.scrolledAwayClass).each(function(){j+=a(this).outerWidth()});var m=j-k.outerWidth();a(l.listSelector).animate({marginLeft:"-"+m+"px"});k.removeClass(l.scrolledAwayClass)}function f(n){var k=n.data("config-scrollTabs");var m=a(a(k.scrollableSelector+":not('."+k.scrolledAwayClass+"'):first"));var j=0;a("."+k.scrolledAwayClass).each(function(){j+=a(this).outerWidth()});var l=j+m.outerWidth();a(k.listSelector).animate({marginLeft:"-"+l+"px"});m.addClass(k.scrolledAwayClass)}};a.fn.scrollTabs.defaults={containerSelector:"#widgetMeta .header",listSelector:"ul.summaryTabs",scrollableSelector:"ul.summaryTabs li.scrollable",scrollArrowsSelector:"ul.summaryTabs li.scrollArrow",scrollArrowPrevSelector:"ul.summaryTabs li.prev",scrollArrowNextSelector:"ul.summaryTabs li.next",scrolledAwayClass:"scrolledAway"}})(jQuery);var blistCommonNS=blist.namespace.fetch("blist.common");blistCommonNS.formInliner=function(c){var b=$(c.target);var a=b.data("dataset").cleanCopy();if(b.find("input[name=view]").size()>0){return}b.append($('<input type="hidden" name="view"/>').val(JSON.stringify(a))).append($('<input type="hidden" name="method" value="index" />'))};(function(a){a.fn.downloadToFormCatcher=function(c,b){return this.each(function(){var d=a(this);var e;d.off(".downloadToFormCatcher");d.on("click.downloadToFormCatcher",function(h){var j=_.isUndefined(e)||(_.now()-e)>(30*1000);if(!j){return false}e=_.now();if(c.temporary!==true){return true}h.preventDefault();var g=d.attr("href").replace(/\w{4}-\w{4}/,"INLINE");var f=a("<form>").attr("ACTION",g).attr("method","post");f.data("dataset",c);(b||d).append(f);f.bind("submit",blistCommonNS.formInliner);f.submit()})})}})(jQuery);(function(e){var b={calendar:{name:"calendar",domId:"calendarRenderType",initFunction:"socrataCalendar",javascripts:[{assets:"shared-calendar"}],stylesheets:[{assets:"display-calendar"},"/stylesheets/fullcalendar.css",{assets:"rich-render-bundle"}],scrollsInline:false},chart:{name:"chart",domId:"chartRenderType",initFunction:"socrataChart",javascripts:[{assets:"shared-chart"}],stylesheets:["/stylesheets/chart-screen.css",{assets:"rich-render-bundle"},{assets:"display-chart"}],scrollsInline:true,translations:["controls.charts","controls.common.visualization"]},form:{name:"form",domId:"staticRenderType",initFunction:function(){},scrollsInline:false},map:{name:"map",domId:"mapRenderType",initFunction:"socrataMap",javascripts:["https://serverapi.arcgisonline.com/jsapi/arcgis/?v=2.3",false,{assets:"shared-map"}],stylesheets:[{assets:"render-images-bundle",hasImages:true},{assets:"display-map"},{assets:"rich-render-bundle"}],scrollsInline:true,translations:["controls.map","controls.common.visualization"]},geoRows:{name:"geoRows",domId:"mapRenderType",initFunction:"socrataMap",javascripts:["https://serverapi.arcgisonline.com/jsapi/arcgis/?v=2.3",false,{assets:"shared-map"}],stylesheets:[{assets:"render-images-bundle",hasImages:true},{assets:"display-map"},{assets:"rich-render-bundle"}],scrollsInline:true,translations:["controls.map","controls.common.visualization"]},fatrow:{name:"fatrow",domId:"fatRowRenderType",initFunction:function(g,h){g.fatrowRenderType(e.extend({view:h.view,columnDeleteEnabled:h.editEnabled&&h.view.type=="blist"&&h.view.hasRight(blist.rights.view.REMOVE_COLUMN),columnPropertiesEnabled:h.editEnabled},h.common,h.fatrow))},javascripts:[{assets:"shared-richRenderers"}],templates:["fatrow","fatrow_header"],translations:["screens.ds.column_tip","controls.grid"],reset:function(){this.$dom.children(".renderContent").removeData().children(".columnHeaders, .rowList").empty().end().children(".templateRow").removeData().empty()},stylesheets:[{assets:"render-images-bundle",hasImages:true},{assets:"rich-render-bundle"}],scrollsInline:false},page:{name:"page",domId:"pageRenderType",initFunction:"pageRenderType",javascripts:[{assets:"shared-richRenderers"}],templates:["page_render_type"],reset:function(){this.$dom.children(".renderContent").removeData().children(".content").empty().removeData().end().children(".navigation").removeData()},stylesheets:[{assets:"render-images-bundle",hasImages:true},{assets:"rich-render-bundle"}],scrollsInline:false},table:{name:"table",domId:"gridRenderType",javascripts:[{assets:"shared-table-render"}],stylesheets:[{assets:"grid",hasImages:true},{assets:"render-images-bundle",hasImages:true}],initFunction:function(g,h){g.datasetGrid(e.extend({view:h.view,columnDeleteEnabled:h.editEnabled&&h.view.type=="blist"&&h.view.hasRight(blist.rights.view.REMOVE_COLUMN),columnPropertiesEnabled:h.columnEditEnabled,columnNameEdit:h.columnEditEnabled&&(h.view.isDefault()||h.view.type=="grouped")&&h.view.hasRight(blist.rights.view.UPDATE_COLUMN),showAddColumns:h.editEnabled&&h.view.type=="blist"&&h.view.hasRight(blist.rights.view.ADD_COLUMN),editEnabled:h.editEnabled},h.common,h.table))},reset:function(){this.$dom.children(".renderContent").empty().removeData().removeClass("blist-table")},scrollsInline:true,translations:["controls.grid","screens.ds"]},href:{name:"href",domId:"staticRenderType",stylesheets:[{assets:"dataset-about-minimal",hasSpecialSelectors:true},{assets:"display-blob"}],javascripts:[{assets:"shared-blob"}],scrollsInline:false,initFunction:function(g,h){g.blobDataset(e.extend({view:h.view,editEnabled:h.editEnabled},h.common,h.href))}},blob:{name:"blob",domId:"staticRenderType",stylesheets:[{assets:"dataset-about-minimal",hasSpecialSelectors:true},{assets:"display-blob"}],javascripts:[{assets:"shared-blob"}],scrollsInline:false,initFunction:function(g,h){g.blobDataset(e.extend({view:h.view,editEnabled:h.editEnabled},h.common,h.blob))}}};b.api=b.table;b.assetinventory=b.table;e.fn.renderTypeManager=function(g){var h=e(this[0]).data("renderTypeManager");if(!h){h=new d(g,this[0])}return h};var d=function(g,h){this.settings=e.extend({},d.defaults,g);this.currentDom=h;this.init()};e.extend(d,{defaults:{defaultTypes:null,handleResize:true,view:null},prototype:{init:function(){var k=this;var j=k.$dom();j.data("renderTypeManager",k);j.find(".renderTypeNode").addClass("hide");k.typeInfos={};k.visibleTypes={};k.settings.view.bind("valid",function(){if(!_.isEmpty(k.visibleTypes)){_.each(k.visibleTypes,function(l,m){if(l){k.show(m)}})}}).bind("displaytype_change",function(){var l=e.extend({},k.settings.view.metadata.renderTypeConfig.visible);_.each(_.keys(k.visibleTypes),function(m){if(!l[m]){k.hide(m)}});_.each(l,function(m,n){if(m){k.show(n)}})});j.delegate(".renderTypeNode > .divider .close","click",function(l){l.preventDefault();k.hide(e(this).closest(".renderTypeNode").data("rendertype"))});k._loadedTypes={};var g=k.settings.defaultTypes||k.settings.view.metadata.renderTypeConfig.visible;if(_.isString(g)){var h={};h[g]=true;g=h}_.each(g,function(l,m){if(l){k.show(m)}});if(k.settings.handleResize){e(window).bind("resize",function(n,m,l){if(m==this){return}_.each(k.visibleTypes,function(o,p){k.$domForType(p).trigger("resize",[this,l])})})}},$dom:function(){if(!this._$dom){this._$dom=e(this.currentDom)}return this._$dom},setTypeConfig:function(h,g){var k=this;var j=a(k,h);k.settings[j.name]=k.settings[j.name]||{};e.extend(k.settings[j.name],g)},show:function(j,h){var l=this;var k=a(l,j);l.visibleTypes[j]=true;if(!l.settings.view.valid){return}var g=e.deepGetStringField(l.settings.view,"metadata.renderTypeConfig.active."+j+".id");if(g&&k.activeView&&k.activeView.id!=g){k._assetsLoaded=true;delete k._initialized;if(_.isFunction(k.reset)){k.reset()}}f(l,j,h);if(k.$dom.is(":visible")){return}k.$dom.removeClass("hide").children(".renderContent").trigger("show");l.$dom().toggleClass("multipleRenderers",l.$dom().children(".renderTypeNode:visible").length>1);l.$dom().trigger("render_type_shown",[j]);e(window).resize()},hide:function(g){var j=this;var h=a(j,g);delete j.visibleTypes[g];if(!h.$dom.is(":visible")){return}h.$dom.addClass("hide").children(".renderContent").trigger("hide");j.$dom().toggleClass("multipleRenderers",j.$dom().children(".renderTypeNode:visible").length>1);j.$dom().trigger("render_type_hidden",[g]);e(window).resize()},toggle:function(g){var h=this;if(h.visibleTypes[g]){h.hide(g)}else{h.show(g)}},$domForType:function(g){var h=this;c(h,g);return a(h,g).$dom.children(".renderContent")}}});var a=function(j,g){if(_.isUndefined(j.typeInfos[g])){var h=e.extend(true,{},b[g]);if(e.isBlank(h)){throw"missing type info for "+g}j.typeInfos[g]=h}return j.typeInfos[g]};var c=function(q,o){var r=a(q,o);var s=r.$dom;if(e.isBlank(s)){s=q.$dom().find("."+r.domId);if(s.length<1){var k=q.settings.view.metadata.availableDisplayTypes;var g;var j=_.indexOf(k,o);var p=q.$dom().children(".renderTypeNode");if(j<0){g=p.eq(0)}for(var l=j+1;l<k.length&&e.isBlank(g);l++){var m=p.filter("[data-renderType="+k[l]+"]");if(m.length>0){g=m}}var n=e.tag2({_:"div",className:["fullHeight","renderTypeNode","hide",r.domId],"data-renderType":o});if(e.isBlank(g)||g.length<1){q.$dom().append(n)}else{g.before(n)}s=q.$dom().find("."+r.domId)}if(s.children(".renderContent").length<1){var h=e.tag({tagName:"div","class":["renderContent","fullHeight"]});h.append(s.children());s.append(h)}if(s.children(".divider").length<1){s.prepend(e.tag({tagName:"div","class":"divider",contents:{tagName:"a",href:"#Hide","class":"close",title:"Hide section",contents:{tagName:"span","class":"icon"}}}))}r.$dom=s}};var f=function(n,l,k){var m=a(n,l);if(m._initialized){return}c(n,l);var h=m.$dom;var j=h.find(".renderContent");var g=function(){n.settings.view.getViewForDisplay(l,function(o){m.activeView=o;if(_.isFunction(e.fn[m.initFunction])){j[m.initFunction](e.extend({view:o,editEnabled:n.settings.editEnabled},n.settings.common,n.settings[m.name],k))}else{if(_.isFunction(m.initFunction)){m.initFunction(j,e.extend({},n.settings,{view:o}))}}j.trigger("show")})};if(!m.scrollsInline){j.removeClass("scrollContent")}else{j.addClass("scrollContent")}if(m._assetsLoaded){g()}else{blist.util.assetLoading.loadAssets(m,g,function(){j.trigger("show");e(window).trigger("resize",[null,true])})}m._initialized=true}})(jQuery);var widgetNS=blist.namespace.fetch("blist.widget");var commonNS=blist.namespace.fetch("blist.common");var configNS=blist.namespace.fetch("blist.configuration");widgetNS.ready=false;blist.widget.resizeViewport=function(){widgetNS.$resizeContainer.fullScreen().adjustSize()};blist.widget.searchToolbarShown=false;blist.widget.showToolbar=function(c,h){var g={search:"toolbarSearchForm",email:"toolbarEmailForm",closePane:"toolbarClosePaneBox",about:"toolbarAboutBox"};var e=g[c];var b=$(".toolbar");var f=!b.hasClass(c);b.removeClass().addClass("toolbar "+c);if(c=="search"){widgetNS.searchToolbarShown=true}var j=$(".widgetContent").innerHeight()*0.5;$(".toolbarAboutBox").css("max-height",j);var a=function(){widgetNS.resizeViewport();if(_.isFunction(h)){h()}};if(!b.is(":visible")){if(c==="about"){b.show().children().show();b.height(Math.min(b.find(".toolbarAboutBox").outerHeight(true),j)).hide()}else{b.height(20)}b.show("slide",{direction:((widgetNS.orientation==="downwards")?"up":"down")},500,a);b.children(":not(.close)").hide().filter("."+e).show()}else{if(f){if(c!="closePane"){widgetNS.closePane()}if(c=="about"){var d=b.find(".toolbarAboutBox");d.show();b.animate({height:Math.min(d.outerHeight(true),j)},500,a);d.hide()}else{b.animate({height:20},500,a)}b.children(":not(.close):visible").fadeOut("fast",function(){b.find("."+e).fadeIn("fast")})}}};blist.widget.hideToolbar=function(){var a=$(".toolbar");if(a.hasClass("search")){widgetNS.searchToolbarShown=false}else{if(widgetNS.searchToolbarShown){widgetNS.showToolbar("search");return}}a.removeClass().addClass("toolbar").hide("slide",{direction:((widgetNS.orientation=="downwards")?"up":"down")},widgetNS.resizeViewport)};blist.widget.feedLoaded=false;blist.widget.viewsLoaded=false;blist.widget.paneHandlers={embed:function(){$("#embed_code").focus().select()},feed:function(){if(widgetNS.feedLoaded){return}widgetNS.feedLoaded=true;blist.dataset.getComments(function(a){$(".widgetContent_feed").append($.renderTemplate("feedList"));$(".widgetContent_feed .feed").feedList({bindCommentEvents:false,comments:a})})},cellFeed:function(b,a){blist.dataset.getComments(function(d){var c=$(".widgetContent_cellFeed");c.empty().append($.renderTemplate("feedList"));c.find(".feed").feedList({bindCommentEvents:false,comments:d})},b,a)},views:function(){if(widgetNS.viewsLoaded){return}widgetNS.viewsLoaded=true;blist.dataset.getRelatedViews(function(a){var b=_.reject(a,function(c){return _.include(["blob","href"],c.type)});b.sort(function(d,c){return c.viewCount-d.viewCount});$(".widgetContent_views").append($.renderTemplate("filtersTable",b,{"tbody .item":{"filter<-":{".type .cellInner.icon":function(c){return c.item.displayName.capitalize()},".type@title":function(c){return c.item.displayName.capitalize()},".type@class+":function(c){return" type"+c.item.styleClass},".name a":"filter.name!",".name a@title":"filter.description!",".name a@href":"filter.url",".viewed .cellInner":"filter.viewCount",".picture a@href":function(c){return new User(c.item.owner).getProfileUrl()},".picture img@src":function(c){return c.item.owner.profileImageUrlMedium||"/images/small-profile.png"},".picture img@alt":"filter.owner.displayName!",".picture img@title":"filter.owner.displayName!"}}}));$(".widgetContent_views td.typeData_lens .icon").addClass("icon-cards");$(".widgetContent_views .name a").each(function(){var c=$(this);if(c.attr("title")===""){return}c.socrataTip({message:(c.attr("title")||"").clean(),shrinkToFit:false,killTitle:true})});$(".widgetContent_views table.gridList").combinationList({headerContainerSelector:".widgetContent_views .gridListWrapper",initialSort:[[2,1]],scrollableBody:false,selectable:false,sortGrouping:false,sortHeaders:{0:{sorter:"text"},1:{sorter:"text"},2:{sorter:"digit"},3:{sorter:false}}})})}};blist.widget.showPane=function(a,d,c,b){if($(".widgetContent_"+a).is(":visible")){return}$(".widgetContent > :visible:first").fadeOut(200,function(){$(".widgetContent_"+a).fadeIn(200);if(!$.isBlank(d)){$(".toolbarClosePaneName").text(d)}widgetNS.showToolbar("closePane");if(!$.isBlank(c)){$(".toolbar").animate({"background-color":c})}if(_.isFunction(widgetNS.paneHandlers[a])){widgetNS.paneHandlers[a].apply(this,b||[])}});$.analytics&&$.analytics.trackEvent("widget (v2)","pane shown: "+a,document.referrer)};blist.widget.closePane=function(){$(".toolbar").animate({"background-color":$(".subHeaderBar").css("background-color")},function(){$(this).css("background-color","")});widgetNS.showDataView()};blist.widget.flashToolbarMessage=function(c,a,b){c.text(a).slideDown(function(){if(typeof b=="function"){b()}setTimeout(function(){c.slideUp()},5000)})};blist.widget.showDataView=function(){if($(".widgetContentGrid").is(":visible")){return}$(".widgetContent > :visible:first").fadeOut(200,function(){$(".widgetContentGrid").fadeIn(200);widgetNS.resizeViewport()})};(function(a){if(!blist.dataset.valid){a("body").addClass("invalidView")}})(jQuery);$(function(){function k(m){return $.t("screens.widget."+m)}blist.dataset.setAccessType("WIDGET");widgetNS.orientation=widgetNS.theme.frame["orientation"];widgetNS.isTabular=_.include(["tabular","geo"],blist.dataset.viewType);widgetNS.interstitial=widgetNS.theme.behavior["interstitial"];widgetNS.$resizeContainer=$(".widgetContent");widgetNS.$resizeContainer.fullScreen();$("select, input:checkbox, input:radio:not(.noUniform), input:file").uniform();var a=widgetNS.theme.menu["options"],h=widgetNS.enabledModules;if(_.any(a)){$(".mainMenu").menu({additionalDataKeys:["targetPane","iconColor"],menuButtonTitle:"Access additional information about this dataset.",menuButtonClass:"mainMenuButton "+((widgetNS.orientation=="downwards")?"upArrow":"downArrow"),contents:[{text:k("menu.more_views"),className:"views",targetPane:"views",subtext:k("menu.more_views_subtext"),href:"#views",iconColor:"#57b6dd",onlyIf:widgetNS.isTabular&&a.more_views},{text:k("menu.download"),className:"downloads",targetPane:"downloads",subtext:k("menu.download_subtext"),href:"#downloads",iconColor:"#959595",onlyIf:widgetNS.isTabular&&a.downloads},{text:k("menu.discuss"),className:"comments",targetPane:"feed",subtext:k("menu.discuss_subtext"),href:"#comments",iconColor:"#bed62b",onlyIf:a.comments&&h.allow_comments==true},{text:k("menu.embed"),className:"embed",targetPane:"embed",subtext:k("menu.embed_subtext"),href:"#embed",iconColor:"#e44044",onlyIf:a.embed},{text:k("menu.api"),className:"api",targetPane:"api",subtext:k("menu.api_subtext"),href:"#api",iconColor:"#f93f06",onlyIf:widgetNS.isTabular&&a.api},{text:k("menu.odata"),className:"api",targetPane:"odata",subtext:k("menu.odata_subtext"),href:"#odata",iconColor:"#f93f06",onlyIf:widgetNS.isTabular&&a.odata},{text:k("menu.print"),className:"print",targetPane:"print",subtext:k("menu.print_subtext"),href:"#print",iconColor:"#a460c4",onlyIf:blist.dataset.isTabular()&&a.print},{text:k("menu.about"),className:"about",href:"http://www.socrata.com/",rel:"external",onlyIf:a.about_sdp}],onOpen:function(){$.analytics&&$.analytics.trackEvent("widget (v2)","main menu opened",document.referrer)}});if(a.about_sdp){$(".mainMenu .menuColumns").addClass("hasAbout")}}$(".mainMenu .menuDropdown a").click(function(m){var o=$(this);var n=o.attr("data-targetPane");if($.isBlank(n)){return}m.preventDefault();widgetNS.showPane(n,o.find(".contents").text(),o.attr("data-iconColor"));if(!$(".widgetContent_"+n).is(":visible")){$.analytics&&$.analytics.trackEvent("widget (v2)","menu item clicked: "+o.attr("href"),document.referrer)}});blist.datasetControls.hookUpShareMenu(blist.dataset,$(".subHeaderBar .share .shareMenu"),{menuButtonClass:"icon",onOpen:function(){$.analytics&&$.analytics.trackEvent("widget (v2)","share menu opened",document.referrer)}},true);var f=$(".toolbar .toolbarSearchForm");f.submit(function(n){n.preventDefault();var m=$(n.currentTarget).find(":input").val();blist.dataset.update({searchString:m})});if(!$.isBlank(blist.dataset.searchString)){widgetNS.showToolbar("search",function(){f.find(":input").focus().val(blist.dataset.searchString).blur()})}var b=$(".toolbar");$(".toolbar .close").click(function(m){m.preventDefault();if(b.hasClass("search")){f.find(":input").val("").blur();blist.dataset.update({searchString:null})}if(b.hasClass("closePane")){widgetNS.closePane()}widgetNS.hideToolbar()});$(".subHeaderBar .about a").click(function(m){m.preventDefault();if(b.hasClass("about")&&b.is(":visible")){widgetNS.hideToolbar()}else{widgetNS.showToolbar("about")}});$(".subHeaderBar .search a").click(function(m){m.preventDefault();if(b.hasClass("search")&&b.is(":visible")){widgetNS.hideToolbar()}else{widgetNS.showToolbar("search")}});$(".shareMenu .email a").click(function(m){if(b.hasClass("email")&&b.is(":visible")){$(".toolbarEmailForm .toolbarTextbox").effect("pulsate",{times:2})}else{widgetNS.showToolbar("email")}});var l=function(n){var m=n.length?"Your emails were sent successfully.":"Some of your emails could not be sent. Please verify the addresses and try again.";widgetNS.flashToolbarMessage($(".toolbarEmailForm .toolbarMessage"),m,function(){var o=$(".toolbarEmailForm .toolbarTextbox");o.val(n.join(", ")).attr("disabled",false).css("background-color",null).css("background-color",widgetNS.theme.toolbar.input_color);if(!n.length){o.blur()}})};$(".toolbarEmailForm .toolbarTextbox, .toolbarSearchForm .toolbarTextbox").val("").blur();$(".toolbar .toolbarEmailForm").submit(function(p){p.preventDefault();var n=$(this);var q=$(".toolbarEmailForm .toolbarTextbox");var r=$.trim(q.val());r=r.split(/[, ]+/);var o=0;var m=r.length;_.each(r,function(s){$.ajax({url:n.attr("action"),cache:false,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({recipient:s}),success:function(t){if($.isBlank(t)||t.error===undefined){r=_.without(r,s)}if(++o==m){l(r)}},error:function(v,t,u){if(++o==m){l(r)}}})});q.attr("disabled",true).animate({"background-color":"#cdc9b7"})});$(".toolbarAboutBox .datasetAverageRating").stars({onChange:function(){$(".actionInterstitial").jqmShow().find(".actionPhrase").text("rate this dataset")}});$(".viewError").text(blist.dataset.invalidMessage());blist.$container.renderTypeManager({view:blist.dataset,editEnabled:false,table:{columnHideEnabled:false,showRowNumbers:widgetNS.theme.grid["row_numbers"],showRowHandle:widgetNS.theme.grid["row_numbers"],manualResize:true,cellCommentsCallback:!blist.widget.enabledModules.cell_comments?null:function(n,m){widgetNS.showPane("cellFeed","Comments for row "+(blist.dataset.rowForID(n).index+1)+", column "+$.htmlEscape(blist.dataset.columnForTCID(m).name),"#bed62b",[n,m])}}});var g=blist.$container.renderTypeManager().$domForType("table");blist.$container.bind("render_type_hidden",function(n,m){if(_.isEmpty(blist.$container.renderTypeManager().visibleTypes)){_.each(blist.dataset.metadata.renderTypeConfig.visible,function(p,o){if(p){blist.$container.renderTypeManager().show(o)}})}});$(document).bind(blist.events.DISPLAY_ROW,function(q,p,s){var m;if(typeof p=="string"&&p.indexOf("/")>-1){var o=p.split("/");m=o[0];p=o[1]}var n=$.deepGet(blist.dataset.metadata.renderTypeConfig,"active","page","id");var r=n==m||$.isBlank(n)&&m==blist.dataset.id;if(!s||(blist.dataset.metadata.renderTypeConfig.visible.page&&!r)){blist.$container.renderTypeManager().setTypeConfig("page",{defaultRowId:p});blist.dataset.showRenderType("page",m,!r)}});var c=blist.dataset.getDownloadType();var j=blist.dataset.newBackend&&blist.dataset.isLayered()?"layer_geojson_attributes":"layer_attributes";var e={downloadTypes:$.templates.downloadsTable.downloadTypes[c],layerDownloadTypes:$.templates.downloadsTable.downloadTypes[j],view:blist.dataset};$(".widgetContent_downloads").append($.renderTemplate("downloadsSectionContent",e,$.templates.downloadsTable.directive[c]));$.templates.downloadsTable.postRender($(".widgetContent_downloads"));if(blist.dataset.isGeoDataset()){$(".widgetContent_downloads").addClass("geoDataset");blist.dataset.getChildOptionsForType("table",function(n){var m=function(o){$(".widgetContent_downloads").find(".layerDownloadsContent .item a").each(function(){var p=$(this);var q=_.detect(n,function(r){return r.id==o});p.attr("href",q.downloadUrl(p.data("type")))})};m(n[0].id);if(n.length>1){$(".widgetContent_downloads").find(".layerTableDownloads").find(".layerChooser").append(_.map(n,function(o){return $.tag({tagName:"option",contents:o.name,"data-uid":o.id},true)}).join("")).change(function(){m($(this).find("option:selected").data("uid"))}).end().addClass("hasChoices")}})}$.live(".feed .commentActions a, .feedNewCommentButton","click",function(n){n.preventDefault();var m="do that";var o=$(this);if(o.is(".commentInappropriateLink:not(.disabled)")){m="report a comment"}else{if(o.is(".commentRateUpLink:not(.ratedUp), .commentRateDownLink:not(.ratedDown)")){m="rate a comment"}else{if(o.is(".commentReplyLink")){m="reply to a comment"}else{if(o.is(".feedNewCommentButton")){m="add a comment"}}}}$(".actionInterstitial").jqmShow().find(".actionPhrase").text(m)});$.live("a.feedActor, #aboutSection a","focus mouseover",function(){$(this).attr("target","_blank")});$(".widgetContent_embed .embedForm").embedForm();$(".widgetContent_print form .submit").click(function(m){m.preventDefault();$(this).closest("form").submit()});$(".widgetContent_print .close").click(function(m){m.preventDefault();widgetNS.closePane();widgetNS.hideToolbar()});if(!$.isBlank(document.referrer)){$(".leavingInterstitial").find(".serverName").text(document.referrer.replace(/(ht|f)tps?:\/\/(www\.)?/,"").replace(/\/.*$/,""))}$.live('a:not([href^=#]):not(.noInterstitial):not([rel$="modal"])',"click",function(o){if(widgetNS.interstitial===true){o.preventDefault();var m=$(this).attr("href");if($.isBlank(m)||(m.indexOf(location)==0)){return}if(m.slice(0,1)=="/"){m=location.host+m}if(!m.match(/^(f|ht)tps?:\/\//)){m=location.protocol+"//"+m}var n=$(".leavingInterstitial");n.find(".leavingLink").attr("href",m).text(m);n.find(".accept.button").attr("href",m);n.jqmShow()}});$(".needsInlineView").data("dataset",blist.dataset).bind("submit",commonNS.formInliner);$(".downloadsList .item .type a").downloadToFormCatcher(blist.dataset);widgetNS.ready=true;if($.device.iphone||$.device.android){_.defer(function(){window.scrollTo(0,1)});g.bind("dataset_ready",function(){$(".mobileNotice").fadeIn();setTimeout(function(){$(".mobileNotice").fadeOut()},10000)});var d=$(".subHeaderAction.fullscreen a");d.attr("href",d.attr("href")+"?no_mobile=true");$(document).bind("touchmove",function(m){m.originalEvent.preventDefault()})}_.defer(function(){blist.dataset.registerOpening(document.referrer);$.analytics&&$.analytics.trackEvent("widget (v2)","page loaded",document.referrer)});if(widgetNS.showPrivateMessage===true){$(".privateDataset").jqmShow()}});blist.widget.ghettoMenuButtonImages={normal:"",hover:""};blist.widget.ghettoHoverHookAdded=false;blist.widget.addGhettoHoverHook=function(){if(widgetNS.ghettoHoverHookAdded){return}$(".mainMenuButton").hover(function(){$(this).css("background-image",widgetNS.ghettoMenuButtonImages.hover)},function(){$(this).css("background-image",widgetNS.ghettoMenuButtonImages.normal)});widgetNS.ghettoHoverHookAdded=true};blist.widget.setGhettoButtonImage=function(a,b){widgetNS.ghettoMenuButtonImages[a]=b;if(a=="normal"){$(".mainMenuButton").css("background-image",widgetNS.ghettoMenuButtonImages.normal)}};